10:14:29 AM [express] GET /api/documents 304 in 568ms :: [{"id":49,"originalFilename":"PO after Next …
10:15:20 AM [express] GET /api/documents 304 in 570ms :: [{"id":49,"originalFilename":"PO after Next …
10:16:38 AM [express] GET /api/documents 304 in 549ms :: [{"id":49,"originalFilename":"PO after Next …
10:16:48 AM [express] DELETE /api/documents/49 204 in 252ms
10:16:48 AM [express] GET /api/documents 200 in 76ms :: [{"id":30,"originalFilename":"PO Partial ทยอย…
10:16:58 AM [express] POST /api/documents 201 in 1884ms :: {"id":50,"originalFilename":"ตั้งหนี้จาก  …
10:17:01 AM [express] GET /api/documents 200 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:02 AM [express] POST /api/documents/50/process 200 in 154ms :: {"id":50,"originalFilename":"ตั้…
Processing document with file extension: pdf using llamaparse
Attempting to process document with LlamaParse...
Global retry attempt 1 of 3
Attempting request to LlamaParse API at https://api.llamaindex.ai/v1/parsing/parse_file (endpoint retry 1/1, global retry 1/3)
Failed on https://api.llamaindex.ai/v1/parsing/parse_file (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaindex.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaindex.ai/v1/parsing/parse_file
Attempting request to LlamaParse API at https://api.llamaindex.ai/api/parse (endpoint retry 1/1, global retry 1/3)
Failed on https://api.llamaindex.ai/api/parse (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaindex.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaindex.ai/api/parse
Attempting request to LlamaParse API at https://api.llamaparse.ai/api/v1/parse (endpoint retry 1/1, global retry 1/3)
Failed on https://api.llamaparse.ai/api/v1/parse (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaparse.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaparse.ai/api/v1/parse
Attempting request to LlamaParse API at https://api-inference.huggingface.co/models/llama/parse (endpoint retry 1/1, global retry 1/3)
10:17:02 AM [express] GET /api/documents 200 in 77ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:05 AM [express] GET /api/documents 304 in 79ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:09 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:12 AM [express] GET /api/documents 304 in 79ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:15 AM [express] GET /api/documents 304 in 77ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:19 AM [express] GET /api/documents 304 in 78ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:22 AM [express] GET /api/documents 304 in 78ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:25 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:29 AM [express] GET /api/documents 304 in 78ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
Failed on https://api-inference.huggingface.co/models/llama/parse (endpoint retry 1/1): socket hang up
Moving to next endpoint after 1 failed attempts on https://api-inference.huggingface.co/models/llama/parse
All endpoints failed. Global retry 1/3 in 4 seconds...
10:17:32 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:36 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
Global retry attempt 2 of 3
Attempting request to LlamaParse API at https://api.llamaindex.ai/v1/parsing/parse_file (endpoint retry 1/1, global retry 2/3)
Failed on https://api.llamaindex.ai/v1/parsing/parse_file (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaindex.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaindex.ai/v1/parsing/parse_file
Attempting request to LlamaParse API at https://api.llamaindex.ai/api/parse (endpoint retry 1/1, global retry 2/3)
Failed on https://api.llamaindex.ai/api/parse (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaindex.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaindex.ai/api/parse
Attempting request to LlamaParse API at https://api.llamaparse.ai/api/v1/parse (endpoint retry 1/1, global retry 2/3)
Failed on https://api.llamaparse.ai/api/v1/parse (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaparse.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaparse.ai/api/v1/parse
Attempting request to LlamaParse API at https://api-inference.huggingface.co/models/llama/parse (endpoint retry 1/1, global retry 2/3)
10:17:39 AM [express] GET /api/documents 304 in 79ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:42 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:46 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:49 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:52 AM [express] GET /api/documents 304 in 75ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:56 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:17:59 AM [express] GET /api/documents 304 in 77ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:18:02 AM [express] GET /api/documents 304 in 75ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:18:06 AM [express] GET /api/documents 304 in 79ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
Failed on https://api-inference.huggingface.co/models/llama/parse (endpoint retry 1/1): socket hang up
Moving to next endpoint after 1 failed attempts on https://api-inference.huggingface.co/models/llama/parse
All endpoints failed. Global retry 2/3 in 8 seconds...
10:18:09 AM [express] GET /api/documents 304 in 77ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:18:13 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
Global retry attempt 3 of 3
Attempting request to LlamaParse API at https://api.llamaindex.ai/v1/parsing/parse_file (endpoint retry 1/1, global retry 3/3)
Failed on https://api.llamaindex.ai/v1/parsing/parse_file (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaindex.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaindex.ai/v1/parsing/parse_file
Attempting request to LlamaParse API at https://api.llamaindex.ai/api/parse (endpoint retry 1/1, global retry 3/3)
Failed on https://api.llamaindex.ai/api/parse (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaindex.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaindex.ai/api/parse
Attempting request to LlamaParse API at https://api.llamaparse.ai/api/v1/parse (endpoint retry 1/1, global retry 3/3)
Failed on https://api.llamaparse.ai/api/v1/parse (endpoint retry 1/1): getaddrinfo ENOTFOUND api.llamaparse.ai
Moving to next endpoint after 1 failed attempts on https://api.llamaparse.ai/api/v1/parse
Attempting request to LlamaParse API at https://api-inference.huggingface.co/models/llama/parse (endpoint retry 1/1, global retry 3/3)
10:18:16 AM [express] GET /api/documents 304 in 76ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
10:18:20 AM [express] GET /api/documents 304 in 79ms :: [{"id":50,"originalFilename":"ตั้งหนี้จาก  PO…
Failed on https://api-inference.huggingface.co/models/llama/parse (endpoint retry 1/1): socket hang up
Moving to next endpoint after 1 failed attempts on https://api-inference.huggingface.co/models/llama/parse
LlamaParse processing failed, falling back to OpenAI Vision: AxiosError: socket hang up
    at AxiosError.from (file:///home/runner/workspace/node_modules/axios/lib/core/AxiosError.js:92:14)
    at RedirectableRequest.handleRequestError (file:///home/runner/workspace/node_modules/axios/lib/adapters/http.js:620:25)
    at RedirectableRequest.emit (node:events:530:35)
    at eventHandlers.<computed> (/home/runner/workspace/node_modules/follow-redirects/index.js:49:24)
    at ClientRequest.emit (node:events:518:28)
    at emitErrorEvent (node:_http_client:101:11)
    at TLSSocket.socketOnEnd (node:_http_client:528:5)
    at TLSSocket.emit (node:events:530:35)
    at endReadableNT (node:internal/streams/readable:1698:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)
    at Axios.request (file:///home/runner/workspace/node_modules/axios/lib/core/Axios.js:45:41)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.processDocument (/home/runner/workspace/server/services/llamaparseService.ts:161:34)
    at async Object.processDocument (/home/runner/workspace/server/services/ocrService.ts:143:34)
    at async Timeout._onTimeout (/home/runner/workspace/server/routes.ts:221:29) {
  code: 'ECONNRESET',
  config: {
    transitional: {
      silentJSONParsing: true,
      forcedJSONParsing: true,
      clarifyTimeoutError: false
    },
    adapter: [ 'xhr', 'http', 'fetch' ],
    transformRequest: [ [Function: transformRequest] ],
    transformResponse: [ [Function: transformResponse] ],
    timeout: 180000,
    xsrfCookieName: 'XSRF-TOKEN',
    xsrfHeaderName: 'X-XSRF-TOKEN',
    maxContentLength: 52428800,
    maxBodyLength: 52428800,
    env: { FormData: [Function [FormData]], Blob: [class Blob] },
    validateStatus: [Function: validateStatus],
    headers: Object [AxiosHeaders] {
      Accept: 'application/json, text/plain, */*',
      'Content-Type': 'multipart/form-data; boundary=--------------------------828924222693029551631566',
      Authorization: 'Bearer llx-sXOJiTJ4HfDycq2WBiG5iO4me8MNocZLZHGBZwoVd7gqmjX3',
      'User-Agent': 'axios/1.8.4',
      'Content-Length': '220527',
      'Accept-Encoding': 'gzip, compress, deflate, br'
    },
    method: 'post',
    url: 'https://api-inference.huggingface.co/models/llama/parse',
    data: FormData {
      _overheadLength: 1148,
      _valueLength: 219379,
      _valuesToMeasure: [],
      writable: false,
      readable: true,
      dataSize: 0,
      maxDataSize: 2097152,
      pauseStreams: true,
      _released: true,
      _streams: [],
      _currentStream: null,
      _insideLoop: false,
      _pendingNext: false,
      _boundary: '--------------------------828924222693029551631566',
      _events: [Object: null prototype],
      _eventsCount: 3
    },
    allowAbsoluteUrls: true
  },
  request: <ref *1> Writable {
    _events: {
      close: undefined,
      error: [Function: handleRequestError],
      prefinish: undefined,
      finish: undefined,
      drain: undefined,
      response: [Function: handleResponse],
      socket: [Array],
      timeout: undefined,
      abort: undefined
    },
    _writableState: WritableState {
      highWaterMark: 16384,
      length: 0,
      corked: 0,
      onwrite: [Function: bound onwrite],
      writelen: 0,
      bufferedIndex: 0,
      pendingcb: 0,
      [Symbol(kState)]: 17580812,
      [Symbol(kBufferedValue)]: null
    },
    _maxListeners: undefined,
    _options: {
      maxRedirects: 21,
      maxBodyLength: 52428800,
      protocol: 'https:',
      path: '/models/llama/parse',
      method: 'POST',
      headers: [Object: null prototype],
      agents: [Object],
      auth: undefined,
      family: undefined,
      beforeRedirect: [Function: dispatchBeforeRedirect],
      beforeRedirects: [Object],
      hostname: 'api-inference.huggingface.co',
      port: '',
      agent: undefined,
      nativeProtocols: [Object],
      pathname: '/models/llama/parse'
    },
    _ended: false,
    _ending: false,
    _redirectCount: 0,
    _redirects: [],
    _requestBodyLength: 0,
    _requestBodyBuffers: [],
    _eventsCount: 3,
    _onNativeResponse: [Function (anonymous)],
    _currentRequest: ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: false,
      _last: false,
      chunkedEncoding: false,
      shouldKeepAlive: true,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: null,
      _hasBody: true,
      _trailer: '',
      finished: false,
      _headerSent: false,
      _closed: false,
      socket: [TLSSocket],
      _header: null,
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/models/llama/parse',
      _ended: false,
      res: null,
      aborted: false,
      timeoutCb: [Function: emitRequestTimeout],
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'api-inference.huggingface.co',
      protocol: 'https:',
      _redirectable: [Circular *1],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 16384,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    _currentUrl: 'https://api-inference.huggingface.co/models/llama/parse',
    _timeout: null,
    [Symbol(shapeMode)]: true,
    [Symbol(kCapture)]: false
  },
  cause: Error: socket hang up
      at TLSSocket.socketOnEnd (node:_http_client:528:25)
      at TLSSocket.emit (node:events:530:35)
      at endReadableNT (node:internal/streams/readable:1698:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {
    code: 'ECONNRESET'
  }
}
Processing document with OpenAI Vision fallback...
Error processing document with all available methods: BadRequestError: 400 Invalid MIME type. Only image types are supported.
    at Function.generate (/home/runner/workspace/node_modules/openai/src/error.ts:72:14)
    at OpenAI.makeStatusError (/home/runner/workspace/node_modules/openai/src/core.ts:462:21)
    at OpenAI.makeRequest (/home/runner/workspace/node_modules/openai/src/core.ts:526:24)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.processDocument (/home/runner/workspace/server/services/ocrService.ts:242:28)
    at async Timeout._onTimeout (/home/runner/workspace/server/routes.ts:221:29) {
  status: 400,
  headers: {
    'access-control-expose-headers': 'X-Request-ID',
    'alt-svc': 'h3=":443"; ma=86400',
    'cf-cache-status': 'DYNAMIC',
    'cf-ray': '9312f0bc7ffd6750-ATL',
    connection: 'keep-alive',
    'content-length': '180',
    'content-type': 'application/json',
    date: 'Wed, 16 Apr 2025 10:18:44 GMT',
    'openai-organization': 'pegasus001',
    'openai-processing-ms': '12',
    'openai-version': '2020-10-01',
    server: 'cloudflare',
    'set-cookie': '__cf_bm=DCQH2UqOa2GoqPJNzBXDTteE.js7Bc6tGzenCkWhjdQ-1744798724-1.0.1.1-ThUPTLGsvIsr4vXh6Ta.ia9NuQ53EXl2d_PyNeaU.KwYzmkaI6K5HUp31rsbbP6azKkKcKD8eBIcahtqyWPZUNGlRAZTl0WZonsUIGXRA2w; path=/; expires=Wed, 16-Apr-25 10:48:44 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=2OTwTGp7VxjUQoty3hEJvwntzy7QSYyHBoD_IVWAshI-1744798724713-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',
    'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',
    'x-content-type-options': 'nosniff',
    'x-ratelimit-limit-input-images': '50000',
    'x-ratelimit-limit-requests': '10000',
    'x-ratelimit-limit-tokens': '10000000',
    'x-ratelimit-remaining-input-images': '49999',
    'x-ratelimit-remaining-requests': '9999',
    'x-ratelimit-remaining-tokens': '9998972',
    'x-ratelimit-reset-input-images': '1ms',
    'x-ratelimit-reset-requests': '6ms',
    'x-ratelimit-reset-tokens': '6ms',
    'x-request-id': 'req_28ea4bcc3ae1516ef4949bbb0163517b'
  },
  request_id: 'req_28ea4bcc3ae1516ef4949bbb0163517b',
  error: {
    message: 'Invalid MIME type. Only image types are supported.',
    type: 'invalid_request_error',
    param: null,
    code: 'invalid_image_format'
  },
  code: 'invalid_image_format',
  param: null,
  type: 'invalid_request_error'
}
Error processing document 50: BadRequestError: 400 Invalid MIME type. Only image types are supported.
    at Function.generate (/home/runner/workspace/node_modules/openai/src/error.ts:72:14)
    at OpenAI.makeStatusError (/home/runner/workspace/node_modules/openai/src/core.ts:462:21)
    at OpenAI.makeRequest (/home/runner/workspace/node_modules/openai/src/core.ts:526:24)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.processDocument (/home/runner/workspace/server/services/ocrService.ts:242:28)
    at async Timeout._onTimeout (/home/runner/workspace/server/routes.ts:221:29) {
  status: 400,
  headers: {
    'access-control-expose-headers': 'X-Request-ID',
    'alt-svc': 'h3=":443"; ma=86400',
    'cf-cache-status': 'DYNAMIC',
    'cf-ray': '9312f0bc7ffd6750-ATL',
    connection: 'keep-alive',
    'content-length': '180',
    'content-type': 'application/json',
    date: 'Wed, 16 Apr 2025 10:18:44 GMT',
    'openai-organization': 'pegasus001',
    'openai-processing-ms': '12',
    'openai-version': '2020-10-01',
    server: 'cloudflare',
    'set-cookie': '__cf_bm=DCQH2UqOa2GoqPJNzBXDTteE.js7Bc6tGzenCkWhjdQ-1744798724-1.0.1.1-ThUPTLGsvIsr4vXh6Ta.ia9NuQ53EXl2d_PyNeaU.KwYzmkaI6K5HUp31rsbbP6azKkKcKD8eBIcahtqyWPZUNGlRAZTl0WZonsUIGXRA2w; path=/; expires=Wed, 16-Apr-25 10:48:44 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None, _cfuvid=2OTwTGp7VxjUQoty3hEJvwntzy7QSYyHBoD_IVWAshI-1744798724713-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None',
    'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',
    'x-content-type-options': 'nosniff',
    'x-ratelimit-limit-input-images': '50000',
    'x-ratelimit-limit-requests': '10000',
    'x-ratelimit-limit-tokens': '10000000',
    'x-ratelimit-remaining-input-images': '49999',
    'x-ratelimit-remaining-requests': '9999',
    'x-ratelimit-remaining-tokens': '9998972',
    'x-ratelimit-reset-input-images': '1ms',
    'x-ratelimit-reset-requests': '6ms',
    'x-ratelimit-reset-tokens': '6ms',
    'x-request-id': 'req_28ea4bcc3ae1516ef4949bbb0163517b'
  },
  request_id: 'req_28ea4bcc3ae1516ef4949bbb0163517b',
  error: {
    message: 'Invalid MIME type. Only image types are supported.',
    type: 'invalid_request_error',
    param: null,
    code: 'invalid_image_format'
  },
  code: 'invalid_image_format',
  param: null,
  type: 'invalid_request_error'
}